<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPL Predictable Betting Engine v2.0</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header .subtitle {
            font-size: 1.2em;
            color: #7f8c8d;
            font-weight: 400;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .status-item {
            text-align: center;
            flex: 1;
        }

        .status-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #27ae60;
        }

        .status-label {
            font-size: 0.9em;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .status-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .status-available {
            color: #27ae60;
        }

        .status-limited {
            color: #f39c12;
        }

        .status-missing {
            color: #e74c3c;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            font-size: 1.5em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prediction-section {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .prediction-section h2 {
            color: white;
        }

        .match-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .team-select {
            flex: 1;
            min-width: 150px;
        }

        .team-select label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            opacity: 0.9;
        }

        .team-select select {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1em;
            font-weight: 500;
        }

        .team-select select option {
            background: #2c3e50;
            color: white;
            padding: 10px;
        }

        .predict-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 25px;
        }

        .predict-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 184, 148, 0.3);
        }

        .predict-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Extracted from inline styles */
        .h3-center { margin-bottom: 20px; text-align: center; }
        .h4-mb { margin-bottom: 15px; }
        .scroll-y-500 { max-height: 500px; overflow-y: auto; }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .prediction-results {
            display: none;
            margin-top: 25px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .prediction-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prediction-metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
            opacity: 0.9;
        }

        .metric-value {
            font-size: 1.2em;
            font-weight: 700;
        }

        .confidence-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            border-radius: 3px;
            transition: width 0.8s ease;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .position {
            width: 40px;
            text-align: center;
            font-weight: 700;
            color: #7f8c8d;
        }

        .team-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .points {
            font-weight: 700;
            color: #27ae60;
        }

        .match-item, .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #74b9ff;
        }

        .match-teams, .player-info {
            font-weight: 600;
            color: #2c3e50;
        }

        .match-score, .player-goals {
            font-size: 1.2em;
            font-weight: 700;
            color: #e74c3c;
        }

        .player-team {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .success-message {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .betting-tips {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .tip-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border-left: 4px solid #00b894;
        }

        .tip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .tip-market {
            font-weight: 600;
        }

        .tip-recommendation {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .tip-reasoning {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .footer {
            text-align: center;
            padding: 30px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
    <div class="header">
        <h1><i class="fas fa-futbol"></i> EPL Predictable Betting Engine</h1>
        <p class="subtitle">Advanced ML Predictions for 2025-2026 Season</p>
    </div>        <div class="status-bar" id="statusBar">
            <div class="status-item">
                <div class="status-value" id="teamsCount">20</div>
                <div class="status-label">Teams</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="matchesCount">10</div>
                <div class="status-label">Matches</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="playersCount">15</div>
                <div class="status-label">Players</div>
            </div>
            <div class="status-item">
                <div class="status-value" id="mlStatus">ML READY</div>
                <div class="status-label">Prediction Engine</div>
            </div>
        </div>

        <div class="data-status">
            <div class="status-card">
                <div class="status-icon status-available">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3>Current Season Data</h3>
                <p>2024-25 standings, results & player stats</p>
            </div>
            <div class="status-card">
                <div class="status-icon status-limited">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3>Full EPL Schedule</h3>
                <p>Limited fixture data available</p>
            </div>
            <div class="status-card">
                <div class="status-icon status-missing">
                    <i class="fas fa-times-circle"></i>
                </div>
                <h3>Historical Odds</h3>
                <p>No historical betting odds loaded</p>
            </div>
            <div class="status-card">
                <div class="status-icon status-missing">
                    <i class="fas fa-times-circle"></i>
                </div>
                <h3>Multi-Season History</h3>
                <p>Only current season available</p>
            </div>
        </div>

        <div class="main-grid">
            <div class="card prediction-section">
                <h2><i class="fas fa-brain"></i> AI Match Prediction</h2>
                
                <div class="match-selector">
                    <div class="team-select">
                        <label for="homeTeam">Home Team:</label>
                        <select id="homeTeam" name="homeTeam" title="Select home team">
                            <option value="">Select home team...</option>
                        </select>
                    </div>
                    <div class="team-select">
                        <label for="awayTeam">Away Team:</label>
                        <select id="awayTeam" name="awayTeam" title="Select away team">
                            <option value="">Select away team...</option>
                        </select>
                    </div>
                </div>
                
                <button class="predict-btn" id="predictBtn">
                    <i class="fas fa-magic"></i> Generate Prediction
                </button>

                <div class="loading" id="loadingDiv">
                    <div class="spinner"></div>
                    <p>Generating AI prediction...</p>
                </div>

                <div class="error-message" id="errorMessage"></div>
                <div class="success-message" id="successMessage"></div>

                <div class="prediction-results" id="predictionResults">
                    <h3 class="h3-center">
                        <span id="matchTitle">Match Prediction</span>
                    </h3>
                    
                    <div class="prediction-metric">
                        <span class="metric-label">Total Goals</span>
                        <span class="metric-value" id="totalGoals">2.5</span>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="goalsConfidence"></div>
                    </div>

                    <div class="prediction-metric">
                        <span class="metric-label">Match Result</span>
                        <span class="metric-value" id="matchResult">Home Win</span>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="resultConfidence"></div>
                    </div>

                    <div class="prediction-metric">
                        <span class="metric-label">Over 2.5 Goals</span>
                        <span class="metric-value" id="over25Probability">65%</span>
                    </div>

                    <div class="prediction-metric">
                        <span class="metric-label">Both Teams Score</span>
                        <span class="metric-value" id="bttsProb">71%</span>
                    </div>

                    <div class="betting-tips" id="bettingTips">
                        <h4 class="h4-mb">Betting Recommendations</h4>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2><i class="fas fa-trophy"></i> Premier League Table</h2>
                <div class="scroll-y-500">
                    <table class="table">
                        <thead>
                            <tr>
                                <th class="position">#</th>
                                <th>Team</th>
                                <th>P</th>
                                <th>W</th>
                                <th>D</th>
                                <th>L</th>
                                <th>GF</th>
                                <th>GA</th>
                                <th>GD</th>
                                <th class="points">Pts</th>
                            </tr>
                        </thead>
                        <tbody id="leagueTableBody">
                            <!-- Table data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="card">
                <h2><i class="fas fa-futbol"></i> Recent Matches</h2>
                <div id="recentMatches">
                    <!-- Recent matches will be loaded here -->
                </div>
            </div>

            <div class="card">
                <h2><i class="fas fa-user-star"></i> Top Scorers</h2>
                <div id="topScorers">
                    <!-- Player stats will be loaded here -->
                </div>
            </div>
        </div>

        <div class="footer">
            <p>EPL Predictable Betting Engine v2.0 | Powered by Advanced Machine Learning | Real Data from Premier League API | Season 2025-26</p>
        </div>
    </div>

    <script>
        class EPLBettingEngine {
            constructor() {
                this.apiBaseUrl = 'http://127.0.0.1:8001';
                this.init();
            }

            async init() {
                await this.loadInitialData();
                this.setupEventListeners();
            }

            async loadInitialData() {
                try {
                    await Promise.all([
                        this.loadTeams(),
                        this.loadLeagueTable(), 
                        this.loadRecentMatches(),
                        this.loadTopScorers(),
                        this.checkSystemStatus()
                    ]);
                } catch (error) {
                    console.error('Error loading initial data:', error);
                }
            }

            async loadTeams() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/api/teams`);
                    const data = await response.json();
                    
                    const homeSelect = document.getElementById('homeTeam');
                    const awaySelect = document.getElementById('awayTeam');
                    
                    homeSelect.innerHTML = '<option value="">Select home team...</option>';
                    awaySelect.innerHTML = '<option value="">Select away team...</option>';
                    
                    if (data.teams && Array.isArray(data.teams)) {
                        data.teams.forEach(team => {
                            const option1 = new Option(team.name, team.name);
                            const option2 = new Option(team.name, team.name);
                            homeSelect.add(option1);
                            awaySelect.add(option2);
                        });
                    }
                } catch (error) {
                    console.error('Error loading teams:', error);
                }
            }

            async loadLeagueTable() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/api/teams`);
                    const data = await response.json();
                    
                    const tableBody = document.getElementById('leagueTableBody');
                    tableBody.innerHTML = '';
                    
                    if (data.teams && Array.isArray(data.teams)) {
                        data.teams.forEach((team, index) => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="position">${index + 1}</td>
                                <td class="team-name">${team.name}</td>
                                <td>${team.matches_played || 0}</td>
                                <td>${team.wins || 0}</td>
                                <td>${team.draws || 0}</td>
                                <td>${team.losses || 0}</td>
                                <td>${team.goals_for || 0}</td>
                                <td>${team.goals_against || 0}</td>
                                <td>${team.goal_difference || 0}</td>
                                <td class="points">${team.points || 0}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    }
                } catch (error) {
                    console.error('Error loading league table:', error);
                }
            }

            async loadRecentMatches() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/api/matches`);
                    const data = await response.json();
                    
                    const matchesDiv = document.getElementById('recentMatches');
                    matchesDiv.innerHTML = '';
                    
                    if (data.matches && Array.isArray(data.matches)) {
                        data.matches.slice(0, 5).forEach(match => {
                            const matchDiv = document.createElement('div');
                            matchDiv.className = 'match-item';
                            matchDiv.innerHTML = `
                                <div class="match-teams">${match.home_team} vs ${match.away_team}</div>
                                <div class="match-score">${match.home_score}-${match.away_score}</div>
                            `;
                            matchesDiv.appendChild(matchDiv);
                        });
                    }
                } catch (error) {
                    console.error('Error loading recent matches:', error);
                }
            }

            async loadTopScorers() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/api/players/goals`);
                    const data = await response.json();
                    
                    const scorersDiv = document.getElementById('topScorers');
                    scorersDiv.innerHTML = '';
                    
                    if (data.players && Array.isArray(data.players)) {
                        data.players.slice(0, 8).forEach(player => {
                            const playerDiv = document.createElement('div');
                            playerDiv.className = 'player-item';
                            playerDiv.innerHTML = `
                                <div>
                                    <div class="player-info">${player.name}</div>
                                    <div class="player-team">${player.team}</div>
                                </div>
                                <div class="player-goals">${player.goals}</div>
                            `;
                            scorersDiv.appendChild(playerDiv);
                        });
                    }
                } catch (error) {
                    console.error('Error loading top scorers:', error);
                }
            }

            async checkSystemStatus() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/health`);
                    const data = await response.json();
                    
                    // Update status counts
                    document.getElementById('teamsCount').textContent = 
                        data.data_sources?.real_epl_service?.teams_available || '20';
                    document.getElementById('matchesCount').textContent = 
                        data.data_sources?.real_epl_service?.matches_available || '10';
                    
                    // Update ML status
                    const mlReady = data.data_sources?.ml_prediction_engine?.status?.includes('trained');
                    document.getElementById('mlStatus').textContent = mlReady ? 'ML READY' : 'HEURISTIC';
                    document.getElementById('mlStatus').style.color = mlReady ? '#27ae60' : '#f39c12';
                    
                } catch (error) {
                    console.error('Error checking system status:', error);
                }
            }

            setupEventListeners() {
                document.getElementById('predictBtn').addEventListener('click', () => {
                    this.generatePrediction();
                });
            }

            async generatePrediction() {
                const homeTeam = document.getElementById('homeTeam').value;
                const awayTeam = document.getElementById('awayTeam').value;
                
                if (!homeTeam || !awayTeam) {
                    this.showError('Please select both teams');
                    return;
                }

                if (homeTeam === awayTeam) {
                    this.showError('Please select different teams');
                    return;
                }

                this.showLoading(true);
                this.hideMessages();

                try {
                    const response = await fetch(`${this.apiBaseUrl}/api/predictions/real-time/${homeTeam}/${awayTeam}`, {
                        method: 'POST'
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (data.status === 'success' && data.prediction) {
                        this.displayPrediction(data.prediction, homeTeam, awayTeam);
                        this.showSuccess(`Prediction generated for ${homeTeam} vs ${awayTeam}`);
                    } else {
                        throw new Error('Invalid prediction data received');
                    }

                } catch (error) {
                    console.error('Error generating prediction:', error);
                    this.showError(`Failed to generate prediction: ${error.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            displayPrediction(prediction, homeTeam, awayTeam) {
                // Update match title
                document.getElementById('matchTitle').textContent = `${homeTeam} vs ${awayTeam}`;
                
                // Update prediction values
                document.getElementById('totalGoals').textContent = 
                    prediction.total_goals?.toFixed(1) || '2.5';
                document.getElementById('matchResult').textContent = 
                    this.formatMatchResult(prediction.match_result, prediction.home_win_probability, 
                                         prediction.away_win_probability, prediction.draw_probability);
                document.getElementById('over25Probability').textContent = 
                    `${Math.round((prediction.over_2_5_goals_probability || 0.5) * 100)}%`;
                document.getElementById('bttsProb').textContent = 
                    `${Math.round((prediction.both_teams_score_probability || 0.5) * 100)}%`;
                
                // Update confidence bars
                this.updateConfidenceBar('goalsConfidence', prediction.total_goals_confidence || 0.5);
                this.updateConfidenceBar('resultConfidence', prediction.match_result_confidence || 0.5);
                
                // Display betting tips
                this.displayBettingTips(prediction.betting_tips || []);
                
                // Show results
                document.getElementById('predictionResults').style.display = 'block';
            }

            formatMatchResult(result, homeProb, awayProb, drawProb) {
                const probs = [
                    { type: 'Home Win', prob: homeProb || 0 },
                    { type: 'Away Win', prob: awayProb || 0 },
                    { type: 'Draw', prob: drawProb || 0 }
                ];
                
                const mostLikely = probs.reduce((a, b) => a.prob > b.prob ? a : b);
                return `${mostLikely.type} (${Math.round(mostLikely.prob * 100)}%)`;
            }

            updateConfidenceBar(elementId, confidence) {
                const bar = document.getElementById(elementId);
                if (bar) {
                    bar.style.width = `${Math.round(confidence * 100)}%`;
                }
            }

            displayBettingTips(tips) {
                const tipsDiv = document.getElementById('bettingTips');
                if (tips && tips.length > 0) {
                    const tipsHtml = tips.map(tip => `
                        <div class="tip-item">
                            <div class="tip-header">
                                <span class="tip-market">${tip.market}</span>
                                <span class="tip-recommendation">${tip.recommendation}</span>
                            </div>
                            <div class="tip-reasoning">${tip.reasoning}</div>
                        </div>
                    `).join('');
                    
                    tipsDiv.innerHTML = '<h4 style="margin-bottom: 15px;">Betting Recommendations</h4>' + tipsHtml;
                } else {
                    tipsDiv.innerHTML = '<h4 style="margin-bottom: 15px;">Betting Recommendations</h4><p style="opacity: 0.8;">No specific betting tips available for this match.</p>';
                }
            }

            showLoading(show) {
                document.getElementById('loadingDiv').style.display = show ? 'block' : 'none';
                document.getElementById('predictBtn').disabled = show;
            }

            showError(message) {
                const errorDiv = document.getElementById('errorMessage');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }

            showSuccess(message) {
                const successDiv = document.getElementById('successMessage');
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 3000);
            }

            hideMessages() {
                document.getElementById('errorMessage').style.display = 'none';
                document.getElementById('successMessage').style.display = 'none';
            }
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new EPLBettingEngine();
        });
    </script>
</body>
</html>